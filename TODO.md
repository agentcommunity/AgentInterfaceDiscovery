# AID Project Roadmap & Priorities

This document outlines the execution plan for maturing the Agent Interface Discovery project into a suite of clean, public, and maintainable NPM packages.

**Priorities:**
- `[P1 - CRITICAL]`: Essential for a trustworthy and functional specification.
- `[P2 - IMPORTANT]`: Essential for a good open-source project and community adoption.
- `[P3 - POLISH]`: Nice-to-have features that improve developer experience and project aesthetics.

FYI schema.ts NOT to be changed! 

---

### **Execution Plan**

The work is broken into three phases, designed to deliver value incrementally while ensuring the existing Web UI remains functional throughout.

#### **Phase 1: Foundational Spec & Tooling (P1 Focus)**
*Goal: Establish the canonical spec, a reference implementation, and a validator. Ship version 0.1.*

1.  **[P1] Initial Hygiene & Setup:**
    - Create a `develop` or `refactor/` branch for this work.
    - Purge all `dist/` directories from git and add `dist/` to `.gitignore`.
    - Set up `changesets` for versioning and changelogs. This is critical for communicating changes.
    - Perform a smoke test of the Web UI to ensure it still works after these initial changes.

2.  **[P1] Solidify `@aid/core` (PRD-1):**
    - Ensure all public APIs are pure and browser-safe.
    - Finalize build scripts to produce the required CJS/ESM/Browser artifacts.
    - **Crucially**, implement the `schema:check` script (PRD-1, F-5) to prevent schema drift.

3.  **[P1] Publish Canonical Schema (`@aid/schema`, PRD-3):**
    - Create the simple `@aid/schema` package.
    - Its only job is to hold the `aid.schema.json` generated by `@aid/core`.
    - Ensure the existing `.github/workflows/sync-schema.yml` continues to function, pushing this canonical schema to the separate `docs` repository. This is the link between code and public specification.

4.  **[P1] Ship the Validator (`@aid/conformance`, PRD-2):**
    - Implement the browser-safe validator functions.
    - Implement the Node.js CLI tool (`aid-validate`).
    - **Crucially**, achieve 100% branch coverage on the core validation logic (PRD-2, SC-2).

5.  **[P1] Basic Conformance CI (subset of PRD-4):**
    - Create a baseline `conformance.yml` GitHub Action.
    - This workflow MUST:
        1.  Install dependencies.
        2.  Build all packages.
        3.  Run `schema:check` to prevent drift.
        4.  Run `test:conformance examples/` to ensure all committed examples are valid against the new tools.
    - This creates the "correctness feedback loop" which is the heart of a spec repo.

6.  **Release v0.1.0:**
    - Use `changesets` to version, publish, and tag the first official release of `@aid/core`, `@aid/conformance`, and `@aid/schema`.

---

#### **Phase 2: Improve DX and Harden CI (P2 Focus)**
*Goal: Make the repository easy to contribute to and add stronger quality gates.*

1.  **[P2] Advanced CI (The rest of PRD-4):**
    - Add test matrix for multiple OSes and Node.js versions.
    - Add test coverage reporting and failure thresholds to CI.
    - Add a bundle size check for `@aid/core` to CI.

2.  **[P2] Repository Polish:**
    - Add root `tsconfig.json` with project references.
    - Add shared ESLint + Prettier configs and run across the monorepo.
    - Add `CONTRIBUTING.md` and Issue/PR templates.

3.  **[P2] Documentation:**
    - Add `typedoc` to auto-generate API documentation from source code comments.
    - Add badges (CI status, npm version, coverage) to the READMEs of each package.

---

#### **Phase 3: Long-term Polish (P3 Focus)**
*Goal: Implement "nice-to-have" features that signal a mature, well-maintained project.*

1.  **[P3] Advanced Testing:**
    - Implement or flesh out the `fuzz.test.ts` with `fast-check`.
    - Configure fuzz tests to run nightly instead of on every PR to save CI time.

2.  **[P3] Dependency Management:**
    - Configure Dependabot or Renovate to keep dependencies up-to-date.

3.  **[P3] Performance:**
    - Investigate migrating the test runner from Jest to Vitest for faster local development.

---

### **Standing Requirement**
- **Web UI Must Not Break:** After every significant step, a smoke test must be performed on the `/packages/web` application to ensure its functionality is not impacted by the refactoring.

---

## Next Steps (Post-Schema-Bump — tag 2025-05-25)

This section supersedes the earlier Phase 4-6 outline and merges it with outstanding items in this TODO.

### 0. Hygiene Sprint  (🔛 In progress)
1. **Purge `dist/**` dirs** from repo & add to `.gitignore**. ✅ _done 2025-06-27_
2. Root **`tsconfig.json` + project references**. ✅ _done 2025-06-27_
2a. **Consolidate package layout** (`core`, `conformance`, `web`) renamed to `aid-*` folders. ✅ _done 2025-06-27_
3. **Shared ESLint + Prettier** config; run autofix. 🔧 _config added 2025-06-27_
4. **Changesets** bootstrap & guard script `schema:check`. ✅ _setup 2025-06-27_
5. `.github/workflows/conformance.yml` covering build → schema-check → tests → coverage → bundle-size. ⏳
6. Badges: CI ✅ (coverage, bundle size ⏳)
7. Nightly fuzz tests (fast-check) on core & conformance. ⏳

### 1. Phase 5 — CLI Migration & Polish
1. Add `--migrate` flag to **`aid-validate`** to auto-convert old manifests/configs.
2. Enhance CLI UX: auto-detect artefact type, pretty error table, `--schema-version`, `--quiet`.
3. ✅ Reach **100 % branch coverage** on validator + migrator. _done 2025-06-27_
4. ✅ Publish **@aid/conformance v0.2** with prebuilt binary (npx-friendly, no ts-node). _ready after release workflow_

### 2. Phase 6 — Release Automation & Monitoring
1. Release workflow via **Changesets** to publish *core / conformance / schema* & GitHub releases.
2. Monitoring hooks:
   - Nightly conformance run on `examples/**`.
   - Gzip-size guard (<15 kB) for core browser bundle.
   - Dependabot / Renovate.

### 3. Language SDK Bootstrap
1. Generator script to emit typed models for other runtimes from canonical JSON-Schema.
2. **Python** first: create `aid-core-py` repo & PyPI package with validation helpers.
3. **Go** second: generate `types.go`; weekly GitHub Action (`schedule: cron('@weekly')`) runs `go test ./...` to validate schema compatibility — free minutes on OSS.

### 4. Documentation
1. Move local `packages/core/src/spcification.md` content to **central mkdocs repo**.
2. Quick-start snippets for JS / Python CLI.

---

*The original PRDs are preserved below for detailed requirements.*

════════════════════════════════════════
PRD-1 @aid/core "Browser-first SDK"
════════════════════════════════════════
1 Objective  
Deliver a single, tree-shakable library that lets **any JavaScript runtime** (browser, Deno, Node, workers) generate, resolve, and inspect AID artefacts while remaining the canonical source for spec types & schemas.

2 Success Criteria  
SC-1 `npm i @aid/core` in a blank Vite project → works w/o polyfills or warnings.  
SC-2 `resolveDomain("agentcommunity.org")` <15 kB min+gzip in final bundle.  
SC-3 100 % type coverage (`tsc --noEmit`).  
SC-4 ≥90 % unit-test line coverage.  
SC-5 `pnpm run schema:check` fails CI if `schema/v1/aid.schema.json` drifts.

3 Functional Requirements  
F-1 Export exactly these pure APIs (names frozen):  
 • `buildManifest`, `buildTxtRecord`, `resolveDomain`, `getImplementations`  
 • All Zod schemas & inferred TS types.  
F-2 No Node-only dependencies in public surface (fs, path, yargs).  
F-3 Emit three artefacts (already present in `dist/`):  
   `dist/src/index.js` (CJS)  
   `dist/src/index.mjs` (ESM)  
   `dist/browser/index.mjs` (browser ESM)  
F-4 `package.json`  
   • exports map matches those paths  
   • `"sideEffects": false`  
   • `"files": ["dist"]`  
F-5 Add **schema evolution guard**  
   `pnpm run schema:check` = build → re-run `scripts/generate-schema.ts` → git-diff.  
   CI fails if diff non-empty **unless** `BREAKING_SCHEMA_CHANGE=true`.

4 Non-Functional Requirements  
NF-1 `pnpm watch:core` script – tsc --watch plus tsup --watch.  
NF-2 README must stay intact; new API notes go in a **"vNext additions"** footer.

5 Deliverables  
• Updated build scripts in `packages/core/package.json`.  
• Guard script + docs.  
• Green CI run with > 90 % coverage & size badge.

6 Milestones  
M1 Isolate any stray Node imports.  
M2 Add watch & schema-check scripts.  
M3 Run bundle-size audit; tweak tsup if over 15 kB.  
M4 Publish 0.1.0 to npm.

7 Out-of-Scope  
`writeManifest` & `writeTxtSnippet` (Node-only) – remain internal utilities.

════════════════════════════════════════
PRD-2 @aid/conformance "Validator + CLI"
════════════════════════════════════════
1 Objective  
Ship an authoritative validator (+CLI) that devs & CI systems can run, yet still functions in the browser when imported as a module.

2 Success Criteria  
SC-1 `aid-validate manifest examples/**/aid.json` returns exit 0 for good data.  
SC-2 100 % **branch** coverage on `validateManifest|Txt|Pair`.  
SC-3 Package is installable in browser bundles (functions only).  
SC-4 README unchanged except for a minimal "CLI Flags" section.

3 Functional Requirements  
F-1 Re-export browser-safe functions from `src/validators.ts`.  
F-2 CLI (`src/cli.ts`) with sub-commands: `manifest`, `txt`, `pair`.  
F-3 Exit codes: 0 (success) / 1 (validation errors) / 2 (other runtime error).  
F-4 Workspace script: `pnpm test:conformance <dir>` – enumerates `**/*.json` & `**/*.txt`, pipes each to CLI.  
F-5 Enforce `{ branches: 100 }` coverageThreshold in Jest.  
F-6 CLI flag `--schema-version` forwards to correct core schema (future-proof).  
F-7 CLI imports **compiled** `@aid/core/dist/...`, never TS sources.

4 Non-Functional Requirements  
NF-1 `"private": false` in package.json so npm publish works.  
NF-2 `bin` field → `dist/src/cli.js`.  
NF-3 Dist already exists; make sure build script keeps filenames.

5 Deliverables  
• New tests for multi-string TXT & non-strict pair path.  
• Coverage badge appended to README.

6 Milestones  
M1 Close test gaps, remove or implement `tests/fuzz.test.ts`.  
M2 Add coverage config & fail-fast CI.  
M3 Write helper script for `test:conformance`.  
M4 Publish 0.1.0.

════════════════════════════════════════
PRD-3 @aid/schema "Canonical JSON Schema"
════════════════════════════════════════
1 Objective  
Distribute the generated JSON-Schema as a stand-alone npm artefact so non-TS ecosystems can consume it directly.

2 Success Criteria  
SC-1 `unpkg.com/@aid/schema` returns `aid.schema.json`.  
SC-2 Unpacked package < 20 kB.  
SC-3 Version published whenever @aid/core bumps schema.

3 Functional Requirements  
F-1 Package contents:  
 • `aid.schema.json` (copied/symlinked from `/schema/v1/`)  
 • minimal `package.json`, `README`, `LICENSE`.  
F-2 `postversion` hook: run `pnpm -F @aid/core run schema:generate` then copy into this package before publish.  
F-3 README lists CDN URLs and versioning policy.

4 Non-Functional Requirements  
NF-1 No runtime code; `"type": "commonjs"` to avoid bundler heuristics noise.  
NF-2 `"files": ["aid.schema.json"]`.

5 Milestones  
M1 Scaffold package and copy script.  
M2 Add to release workflow (changesets).  
M3 Publish 0.1.0.

════════════════════════════════════════
PRD-4 Repo-wide Conformance CI & Examples
════════════════════════════════════════
1 Objective  
Guarantee every commit keeps examples valid, schema in sync, bundle slim, and tests fully covered.

2 Success Criteria  
SC-1 `conformance.yml` workflow fails if:  
 • any example artefact invalid,  
 • branch coverage < 100 %,  
 • `schema:check` detects drift,  
 • `packages/core/dist/browser.js` > 16 kB gzip.  
SC-2 Workflow completes < 5 min on `ubuntu-latest`.

3 Functional Requirements  
F-1 GitHub Action steps:  
 1️⃣ Checkout & `pnpm install --frozen-lockfile`  
 2️⃣ `pnpm run schema:check`  
 3️⃣ `pnpm build --filter @aid/*`  
 4️⃣ `pnpm test --filter @aid/conformance -- --coverage`  
 5️⃣ `pnpm run test:conformance examples/`  
 6️⃣ Run size check: `gzip -c packages/core/dist/browser/index.mjs | wc -c`.  
F-2 Cache `~/.pnpm-store`.  
F-3 Add shields.io badges: CI, coverage, gzip size (append to README footers).

4 Non-Functional Requirements  
NF-1 Action YAML lives at `.github/workflows/conformance.yml`.  
NF-2 No edits to README top sections; badges appended.

5 Milestones  
M1 Write size-check script.  
M2 Implement schema-check script (from PRD-1).  
M3 Author workflow & verify green run.  
M4 Add badges.

════════════════════════════════════════
Shared "Schema-bump" Developer Flow
════════════════════════════════════════
1 Edit `packages/core/src/schemas.ts` (only additive/non-breaking).  
2 Run `pnpm watch:core` → rebuild + regenerate schema.  
3 `schema:check` diff prompts commit of generated files & docs update.  
4 Open PR with Changeset; CI (PRD-4) verifies size, coverage, examples.  
5 Merge → Release workflow publishes @aid/core, @aid/schema, @aid/conformance.

These four PRDs give the full roadmap, preserve existing README material, respect current `dist/` layout, and include future-proofing for incremental schema growth.

════════════════════════════════════════
Repo Hygiene & Cleanup Checklist (Pre-work)
════════════════════════════════════════
Purpose  Prepare the code-base for the four PRDs while ensuring the existing Web UI keeps running.

A Tasks – one-time cleanup
A-1 Remove committed build artefacts
 • Delete every `dist/**` directory and add pattern to `.gitignore`.
A-2 Consolidate directory layout
 • Move packages to `/packages/aid-core`, `/packages/aid-conformance`, `/packages/aid-schema`.
 • Keep Web UI at `/packages/web` (marked "private").
A-3 Create root `tsconfig.json` with project references for each package.
A-4 Standardise linting/formatting
 • Add ESLint + Prettier shared config; enable `eslint-plugin-jest` & React where relevant.
A-5 Introduce Changesets for semantic-release flow (install & bootstrap config).
A-6 Ensure existing `.github/workflows/sync-schema.yml` stays functional after path moves.

B Ongoing quality gates (CI)
B-1 Static type check: `tsc --noEmit --build`.
B-2 Lint: `pnpm lint`.
B-3 Unit tests & coverage.
B-4 Bundle-size guard (core browser bundle ≤16 kB gzipped).

════════════════════════════════════════
Execution Roadmap (high-level order)
════════════════════════════════════════
Step 0 Create a `cleanup/` branch.
Step 1 📦 Repo hygiene (A-tasks above)
 1.1 Purge `dist` folders & extend `.gitignore`.
 1.2 Apply directory moves; update import paths; run Web UI smoke test.
 1.3 Add root `tsconfig.json` + package references; verify `pnpm build`

#### Kick-off files for `feat/release-automation`

- `.github/workflows/release.yml` – ✅ _added 2025-06-28_  (automated publishing)
- `package.json` (root) – ✅ _scripts verified 2025-06-28_
- `packages/aid-core/package.json` & `packages/aid-conformance/package.json` – ✅ _publishConfig public & build scripts OK_
- `.changeset/config.json` – ✅ _access set to public_
- `scripts/` (any helper e.g. bundle-size guard)._pending_

Start the branch from an up-to-date `main`.

- `scripts/` (any helper e.g. bundle-size guard)._pending_
- - `packages/aid-schema` – ✅ _created 2025-06-28_ (canonical JSON Schema)
- - `.github/workflows/sync-schema.yml` – ✅ _updated path_